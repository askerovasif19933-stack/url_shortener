–ó–∞—á–µ–º Docker 

Docker —Ä–µ—à–∞–µ—Ç 3 –ø—Ä–æ–±–ª–µ–º—ã:

–æ–¥–∏–Ω–∞–∫–æ–≤–∞—è —Å—Ä–µ–¥–∞ —É –≤—Å–µ—Ö
–±—ã—Å—Ç—Ä–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞
–∏–∑–æ–ª—è—Ü–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤ (API / –ë–î / Redis)

¬´–ü—Ä–æ–µ–∫—Ç –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π docker compose up –∏–ª–∏ docker compose up --build¬ª

–û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–Ω—è—Ç–∏—è
Image (–æ–±—Ä–∞–∑)

–®–∞–±–ª–æ–Ω –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞.

–ü—Ä–∏–º–µ—Ä:

python:3.12-slim
postgres:17
redis:7

Container (–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä)

–ó–∞–ø—É—â–µ–Ω–Ω—ã–π –æ–±—Ä–∞–∑.

docker ps

–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä = –ø—Ä–æ—Ü–µ—Å—Å + —Ñ–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ + —Å–µ—Ç—å.

üìÑ Dockerfile

–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –∫–∞–∫ —Å–æ–±—Ä–∞—Ç—å image.

–¢–≤–æ–π –ø—Ä–∏–º–µ—Ä:

FROM python:3.12-slim
WORKDIR /app
COPY requirements.txt .
RUN pip install -r requirements.txt
COPY src/ .
CMD ["uvicorn", "main:app"]


CMD ‚Äî —á—Ç–æ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

CMD ‚Äî –∫–ª—é—á–µ–≤–∞—è —Å—Ç—Ä–æ–∫–∞ (–≤–∞–∂–Ω–æ)
–°–∫—Ä–∏–ø—Ç:
CMD ["python", "src/main.py"]‚Üí –æ–¥–Ω–æ—Ä–∞–∑–æ–≤–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ

–°–µ—Ä–≤–µ—Ä:
CMD ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8000"]
‚Üí –ø—Ä–æ—Ü–µ—Å—Å –∂–∏–≤—ë—Ç –ø–æ—Å—Ç–æ—è–Ω–Ω–æ
‚Üí –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–µ –ø–∞–¥–∞–µ—Ç

docker-compose.yml –æ–ø–∏—Å—ã–≤–∞–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ —Å—Ä–∞–∑—É.

—Å—Ç–µ–∫ –≤ compose
services:
  api:
  db:
  redis:

–ß—Ç–æ —ç—Ç–æ –∑–Ω–∞—á–∏—Ç
–°–µ—Ä–≤–∏—Å	–†–æ–ª—å
api	FastAPI
db	PostgreSQL
redis	Redis

–ö–∞–∂–¥—ã–π ‚Äî –æ—Ç–¥–µ–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä.

–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (.env)
–í–ê–ñ–ù–û
env_file:
  - .env


–ó–Ω–∞—á–∏—Ç:

Docker Compose —á–∏—Ç–∞–µ—Ç .env

${POSTGRES_DB} –±–µ—Ä—ë—Ç—Å—è –∏–∑ .env

.env.example ‚Äî —Ç–æ–ª—å–∫–æ —à–∞–±–ª–æ–Ω

–ü—Ä–∏–º–µ—Ä

.env

POSTGRES_DB=short_urls
POSTGRES_USER=postgres
POSTGRES_PASSWORD=postgres


Compose:

environment:
  POSTGRES_DB: ${POSTGRES_DB}

–ü–æ—Ä—Ç—ã (—á–∞—Å—Ç—ã–π –≤–æ–ø—Ä–æ—Å)
ports:
  - "8000:8000"

–§–æ—Ä–º–∞—Ç:
HOST:CONTAINER


–ó–Ω–∞—á–∏—Ç:

–±—Ä–∞—É–∑–µ—Ä ‚Üí localhost:8000

–≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ ‚Üí 8000

Volumes (–¥–ª—è –ë–î)
volumes:
  - pgdata:/var/lib/postgresql/data

–ó–∞—á–µ–º:

–¥–∞–Ω–Ω—ã–µ –ë–î –Ω–µ —É–¥–∞–ª—è—é—Ç—Å—è

–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –º–æ–∂–Ω–æ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–≤–∞—Ç—å

docker compose up vs run 
docker compose up
docker compose up --build
docker compose down


 –∑–∞–ø—É—Å–∫–∞–µ—Ç –í–°–ï —Å–µ—Ä–≤–∏—Å—ã
 –ø–æ–¥–Ω–∏–º–∞–µ—Ç —Å–µ—Ç—å
 —Å–µ—Ä–≤–∏—Å—ã –≤–∏–¥—è—Ç –¥—Ä—É–≥ –¥—Ä—É–≥–∞
 —Ç–≤–æ–π –æ—Å–Ω–æ–≤–Ω–æ–π —Ä–µ–∂–∏–º

docker compose run:

docker compose run api

–æ–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
–Ω–µ –ø–æ–¥–Ω–∏–º–∞–µ—Ç –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
–Ω–µ –¥–ª—è —Å–µ—Ä–≤–µ—Ä–æ–≤

–ò—Å–ø–æ–ª—å–∑—É—é—Ç –¥–ª—è:

–º–∏–≥—Ä–∞—Ü–∏–π

—Å–∫—Ä–∏–ø—Ç–æ–≤

–ö–∞–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –æ–±—â–∞—é—Ç—Å—è

–í–Ω—É—Ç—Ä–∏ Docker:

api ‚Üí db:5432
api ‚Üí redis:6379


–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∏–º—è —Å–µ—Ä–≤–∏—Å–∞:

DATABASE_URL=postgresql://postgres:postgres@db:5432/short_urls
REDIS_URL=redis://redis:6379

–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã (–º–∏–Ω–∏–º—É–º)
docker compose up --build   # –∑–∞–ø—É—Å–∫
docker compose down         # –æ—Å—Ç–∞–Ω–æ–≤–∫–∞
docker ps                  # –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker logs api             # –ª–æ–≥–∏
docker exec -it api bash    # –∑–∞–π—Ç–∏ –≤–Ω—É—Ç—Ä—å

